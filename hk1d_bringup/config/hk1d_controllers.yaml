controller_manager:
  ros__parameters:
    update_rate: 500 # 250 Hz  #you should also change maxon_epos3_config.yaml:   - {index: 0x60C2, sub_index: 1, type: int8, value: 1} # Set interpolation time for cyclic modes, this should be equal to Ts in ms = 1000/update_rate
 

    joint_state_broadcaster:
      type: joint_state_broadcaster/JointStateBroadcaster

    forward_effort_controller:
      type: forward_command_controller/ForwardCommandController
   
    ar_mpc_controller:
      type: ar_mpc_controller/AR_MPC_Controller


    teleop_sim2sim_simple_controller:
      type: teleop_sim2sim_simple_controller/TeleopSim2SimSimpleController

    teleop_real2sim_controller:
      type: teleop_real2sim_controller/TeleopReal2SimController

    teleop_real2real_controller:
      type: teleop_real2real_controller/TeleopReal2RealController


forward_position_controller:
  ros__parameters:
    joints:
      - joint1
      - joint2
    interface_name: effort


teleop_sim2sim_simple_controller:
  ros__parameters:
      joints:
        - hk1d_joint_1
        - hk1d_joint_2
      Kp: [120.0,600.0]
      Kd: [80.0,100.0]
      mass: [0.01,0.01]
      max_torque: [100.0] # this is in terms of maxon motor units (Epos driver). 
      # static_friction: 37.397
      
teleop_real2sim_controller:
  ros__parameters:
      joints:
        - operator_joint_1
        - remote_joint_1
      Kp: [-0.00]
      Kd: [-0.00]
      mass: [0.01]
      max_torque: [0.150] # in mNm on robot joint # or 300
      static_friction: 0.0 # 41.0 

teleop_real2real_controller:
  ros__parameters:
      joints:
        - operator_joint_1
        - remote_joint_1
      C5: [-0.0]
      C6: [-0.01]
      Cm: [0.50,0.001]
      Cs: [3.80,0.10]

      C1: [3.8105,0.17] # C1*Vh = (Zs+Cs)*Vh = (Cs[0]+ks)*xh + (Cs[1]+bs)*vh
      C2: [0.99] # 1+C6
      C3: [0.9] # 1+C5
      C4: [-0.50,-0.001] # C4*Ve = (Zm+Cm)*Ve = (Cm[0]+km)*xe + (Cm[1]+bm)*ve
      KI: 25.0  # this is the position integral coefficient added to the remote robot term 
      mass: [0.01] # NOT USED
      max_torque: [0.250,0.250] # in mNm on robot joint # or 300
      static_friction: 0.040 # 0.041
      start_delay: 1500 #time steps 
      unsafe_speed: 9.0 #rad/s (has to be double)


# <<<<<<< sim_2robots_v1.1
ar_mpc_controller:
  ros__parameters:
    joints:
      - operator_joint_1
      - remote_joint_1
    ## CLOSE TO REAL VALUEs (NOT THE SAME)
    # isReal_Slave: true # this is passed automatically by the launch file
    SHOW_STATUS_LEVEL: 1 # the bigger it is, the more info will be printed
    SHOW_Freq: 400 # show info every k time steps
    start_delay: 400 #time steps before controller starts
    Fe_OFFSET: 0.02
    Fh_OFFSET: -0.0005
    Xe_0: -0.0 #rad, beginning of environemnt
    max_torque: 0.220      ## IMPORTANT, Also change the G matrix (constraint on u)
    N: 15  #actually it should be 30 (as in MATLAB)
    # Ts: 0.004 # this is passed from update_rate through the launch file automatically
    km: 0.0105
    bm: 0.0034
    mm: 0.00092
    ks: 0.0105
    bs: 0.0034
    ms: 0.00092 
    # ks: 0.001995
    # bs: 0.000646
    # ms: 0.0175
    static_friction: 0.035
    # fh_offset: 0.0 #324.0      ## this is included in force_slave_config.yaml automatically
    Enforce_terminal_constr: false
    use_slack: true
    slack_weight: 1.0e6  ####################### 
    ke: 0.625
    be: 0.001
    dke_max: 0.3
    dbe_max: 0.08
    w_addit_max: [0.1,0.1,0.05,0.5]
    scale_theta: [1.0, 1.0]
    scale_x: [1.0, 1.0, 1.0, 1.0]
    Qz: [100.0, 0.0, 0.0,   # ferr, xerr, verr
         0.0, 10000.0, 0.0,
         0.0, 0.0, 2.0]
    Pz: [100.0, 0.0, 0.0,
        0.0, 100000.0, 0.0,
        0.0, 0.0,2.0]
    R: [20.0, 0.0, 
        0.0, 10.0]
    ## Feasible always with rad,Nm,N
    # Qz: [0.010, 0.01, 0.01,
    #      0.01, 100.0E1, 0.01,
    #      0.01, 0.01, 20.0]
    # Pz: [100.0, 0.1, 0.4,
    #     0.1, 100.0, 0.9,
    #     0.4, 0.9,20.0]
    # R: [20.0, 0.0, 
    #     0.0, 10.0]
    K: [-0.0, -0.0, 0.00, 0.0,
      0.0, 0.0, -0.0, -0.0]
    eta_0: 1.0
    rho_0: 0.630768654223175
    Lb: 0.01
    d_bar: 1.6073207032797234E-5
    mu: 0.7
    r_tube: 8
    Htube: [1.0E5, 0.0, 0.0, 0.0,
            0.0, 1.0E5, 0.0, 0.0,
            0.0,  0.0, 1.0E5,  0.0,
            0.0,0.0,  0.0, 1.0E5,
            -1.0E5, 0.0, 0.0, 0.0,
            0.0, -1.0E5, 0.0, 0.0,
            0.0,  0.0, -1.0E5,  0.0,
            0.0,0.0,  0.0, -1.0E5]
    q: 12
    cj: [9.426105785751085E-5, 0.028404609939609513, 0.001171925328851522, 0.029063795434597747,
      9.425514404562157E-5, 0.028404805316471316, 0.0011721512662572077, 0.029062264906836423,
      0.9999999999947237, 0.9999999999998248, 0.9999999999947233, 0.999999999999824]
    F: [0.1, 0.0, 0.0, 0.0,
        0.0, 0.5, 0.0, 0.0,
        0.0, 0.0, 0.1, 0.0,
        0.0, 0.0, 0.0, 0.25,
        -0.1, -0.0, -0.0, -0.0,
        -0.0, -0.5, -0.0, 0.0,
        0.0, 0.0, -0.1, -0.0,
        -0.0, -0.0, -0.0, -0.25,
        0.0, 0.0, 0.0, 0.0,
        0.0, 0.0, 0.0,0.0,
        0.0, 0.0, 0.0, 0.0,
        0.0, 0.0, 0.0, 0.0]
    # G: [0.0, 0.0,
    #     0.0, 0.0,
    #     0.0, 0.0,
    #     0.0, 0.0,
    #     0.0, 0.0,
    #     0.0, 0.0,
    #     0.0, 0.0,
    #     0.0, 0.0,
    #     4.0, 0.0,
    #     0.0, 4.0,
    #     -4.0, -0.0,
    #     -0.0, -4.0]
    G: [
      3.0, 0.0,
      0.0, 3.0,
      -3.0, -0.0,
      -0.0, -3.0]
    HXf: [-368.85310812108384E-2, -124.7345819494066E-2, 0.03404179301085051, 0.003439128359865454,
      0.9999999999998248, 0.0013025150077916195, 1.0981213167982298E-4, -32.069079075682644E-2,
      -11.835157121838213, 0.9999999999998248, 368.85310812108384E-2, 124.7345819494066E-2,
      -0.03404179301085051, -0.003439128359865454, 0.9999999999998248, -0.0013025150077916195,
      -1.0981213167982298E-4, 32.069079075682644, 11.835157121838213, 0.9999999999998248,
      -40.91264629628408E-2, -3.996962985132947, -126092.64693392119E-4, -12704.774157868222E-2,
      0.9999999999998248, -40.91264602470808E-2, -3.996962962236981, -126092.65361566366,
      -12704.77366676022, 0.9999999999998248, 107842.09599204268E-4, 10647.34064443607E-2, 1218.0389402162464E-2,
      122.72843775605764E-2, 0.9999999999998248, 51.91378948609036, 5.072036589433748, 159056.7459018984E-4,
      16026.152865430211E-2, 0.9999999999998248, -107842.09599204268E-4, -10647.34064443607E-2,
      -1218.0389402162464E-3, -122.72843775605764E-2, 0.9999999999998248, 0.0, 0.0, 0.0, 0.0,-1.0E4]
    ## Not used values
    Qx_diag: [1.0E8, 1.0E7, 1049999.99998, 5099999.98]
    Rx_diag: [2.0E-5, 1.0E-4]
    Px_diag: [9.811033546891405E9, 1.8794066465744388E8, 9.866878629830065E9, 2.1033208764380717E8]
    Qx: [1.0E8, 0.01, -9999999.9999, 0.0, 0.010000000000000002, 1.0E7, 0.009000000000000001,
      -999999.9, -9999999.9999, 0.009, 1049999.99998, 499999.999, 0.0, -999999.9, 499999.99900000007,
      5099999.98]
    Px: [9.811033546891405E9, 9.624629172707405E8, 147099.8808893982, 13468.92384054833,
      9.624629172707403E8, 1.8794066465744388E8, 13417.945243058448, 7328.183711750013,
      147099.88088939816, 13417.94524305843, 9.866878629830065E9, 9.880631864811484E8,
      13468.923840548328, 7328.183711750011, 9.880631864811484E8, 2.1033208764380717E8]

    # Htube: [-368.85310812114847, -124.73458194942846, 0.03404179301085647, 0.0034391283598660563,
    #   0.0013025150077918476, 1.0981213167984223E-4, -32.069079075688265, -11.835157121840286,
    #   368.85310812114847, 124.73458194942846, -0.03404179301085647, -0.0034391283598660563,
    #   -0.0013025150077918476, -1.0981213167984223E-4, 32.069079075688265, 11.835157121840286,
    #   -40.91264629629125, -3.9969629851336475, -126092.64693394328, -12704.774157870448,
    #   -40.91264602471525, -3.9969629622376814, -126092.65361568575, -12704.773666762447,
    #   107842.09599206157, 10647.340644437934, 1218.0389402164599, 122.72843775607915,
    #   51.91378948609945, 5.072036589434636, 159056.74590192625, 16026.15286543302, -107842.09599206157,
    #   -10647.340644437934, -1218.0389402164599, -122.72843775607915]
 
# ## SIMPLE Values for debugging 
    # N: 15  
    # Ts: 0.01
    # ke: 9.5
    # be: 2.0
    # km: 1.995
    # bm: 0.646
    # mm: 1.75
    # ks: 1.995
    # bs: 0.646
    # ms: 1.75
    # Enforce_terminal_constr: false
    # use_slack: true
    # kh : 0
    # bh : 0
    # mh : 0
    # dke_max: 1.0
    # dbe_max: 0.1
    # scale_th: [1.0, 1.0]
    # scale_x: [1.0, 1.0, 1.0, 1.0]
    # eta_0: 2.0
    # rho_0: 0.630768654223175
    # Lb: 0.01
    # d_bar: 1.6073207032797234E-5
    # mu: 2.0

    # w_addit_max: [1.0E-5, 1.0E-5, 1.0E-3,1.0E-3]
    # # w_addit_max: [1.0E-3,1.0E-3]
    # r_tube: 8
    # Htube: [1.0E5, 0.0, 0.0, 0.0,
    #     0.0, 1.0E5, 0.0, 0.0,
    #     0.0,  0.0, 1.0E5,  0.0,
    #     0.0,0.0,  0.0, 1.0E5,
    #     -1.0E5, 0.0, 0.0, 0.0,
    #     0.0, -1.0E5, 0.0, 0.0,
    #     0.0,  0.0, -1.0E5,  0.0,
    #     0.0,0.0,  0.0, -1.0E5]
    # ke_true : 10
    # be_true : 2
    # q: 12
    # cj: [9.426105785751085E-5, 0.028404609939609513, 0.001171925328851522, 0.029063795434597747,
    #   9.425514404562157E-5, 0.028404805316471316, 0.0011721512662572077, 0.029062264906836423,
    #   0.9999999999947237, 0.9999999999998248, 0.9999999999947233, 0.999999999999824]
    # F: [0.1, 0.0, 0.0, 0.0,
    #     0.0, 0.5, 0.0, 0.0,
    #     0.0, 0.0, 0.1, 0.0,
    #     0.0, 0.0, 0.0, 0.25,
    #     -0.1, -0.0, -0.0, -0.0,
    #     -0.0, -0.5, -0.0, 0.0,
    #     0.0, 0.0, -0.1, -0.0,
    #     -0.0, -0.0, -0.0, -0.25,
    #     0.0, 0.0, 0.0, 0.0,
    #     0.0, 0.0, 0.0,0.0,
    #     0.0, 0.0, 0.0, 0.0,
    #     0.0, 0.0, 0.0, 0.0]
    # G: [0.0, 0.0,
    #     0.0, 0.0,
    #     0.0, 0.0,
    #     0.0, 0.0,
    #     0.0, 0.0,
    #     0.0, 0.0,
    #     0.0, 0.0,
    #     0.0, 0.0,
    #     0.05E-2, 0.0,
    #     0.0, 0.05E-2,
    #     -0.05E-2, -0.0,
    #     -0.0, -0.05E-2]
    # HXf: [-368.85310812108384E-2, -124.7345819494066E-2, 0.03404179301085051, 0.003439128359865454,
    #   0.9999999999998248, 0.0013025150077916195, 1.0981213167982298E-4, -32.069079075682644E-2,
    #   -11.835157121838213, 0.9999999999998248, 368.85310812108384E-2, 124.7345819494066E-2,
    #   -0.03404179301085051, -0.003439128359865454, 0.9999999999998248, -0.0013025150077916195,
    #   -1.0981213167982298E-4, 32.069079075682644, 11.835157121838213, 0.9999999999998248,
    #   -40.91264629628408E-2, -3.996962985132947, -126092.64693392119E-4, -12704.774157868222E-2,
    #   0.9999999999998248, -40.91264602470808E-2, -3.996962962236981, -126092.65361566366,
    #   -12704.77366676022, 0.9999999999998248, 107842.09599204268E-4, 10647.34064443607E-2, 1218.0389402162464E-2,
    #   122.72843775605764E-2, 0.9999999999998248, 51.91378948609036, 5.072036589433748, 159056.7459018984E-4,
    #   16026.152865430211E-2, 0.9999999999998248, -107842.09599204268E-4, -10647.34064443607E-2,
    #   -1218.0389402162464E-3, -122.72843775605764E-2, 0.9999999999998248, 0.0, 0.0, 0.0, 0.0,-1.0E4]
    # Qx_diag: [1.0E8, 1.0E7, 1049999.99998, 5099999.98]
    # Rx_diag: [2.0E-5, 1.0E-4]
    # Px_diag: [9.811033546891405E9, 1.8794066465744388E8, 9.866878629830065E9, 2.1033208764380717E8]
    # Qx: [1.0E8, 0.01, -9999999.9999, 0.0, 0.010000000000000002, 1.0E7, 0.009000000000000001,
    #   -999999.9, -9999999.9999, 0.009, 1049999.99998, 499999.999, 0.0, -999999.9, 499999.99900000007,
    #   5099999.98]
    # Px: [9.811033546891405E9, 9.624629172707405E8, 147099.8808893982, 13468.92384054833,
    #   9.624629172707403E8, 1.8794066465744388E8, 13417.945243058448, 7328.183711750013,
    #   147099.88088939816, 13417.94524305843, 9.866878629830065E9, 9.880631864811484E8,
    #   13468.923840548328, 7328.183711750011, 9.880631864811484E8, 2.1033208764380717E8]
    # Qz: [5.0E8, 0.01, 0.01, 0.01, 1.0E6, 0.01, 0.01, 0.01, 100000.0]
    # Pz: [5.0132461979024434E9, 1.9339266170495845E3, 4.5E2,
    #  1.9339266170482654E3, 9.714402358660137E6, 9.533492477341105E3,
    #   4.5E2, 9.533492477341112E3,1.9072971044708241E6]
    # R: [2.0E-3, 1.0E-5, 1.0E-3, 1.0E-4]
    # K: [-7.377062162422969, -2.494691638988569, 0.6, 0.0,
    #   0.0, 0.0, -0.6413815815137652, -2.367031424368057]
